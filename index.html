<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœƒå“¡ç®¡ç†ç³»çµ± - åŸå‹ (v3)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f8fafc; /* gray-50 */
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: max-content;
            max-width: 320px;
            background-color: #1f2937; /* gray-800 */
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 50;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        /* For Column Selector Dropdown */
        .dropdown {
            position: relative;
            display: inline-block;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: #f9f9f9;
            min-width: 180px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 10;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            padding: 8px 0;
        }
        .dropdown-content label {
            color: black;
            padding: 8px 16px;
            text-decoration: none;
            display: block;
            cursor: pointer;
            font-size: 14px;
        }
        .dropdown-content label:hover {
            background-color: #f1f1f1;
        }
        .dropdown:hover .dropdown-content {
            display: block;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- ä¸»æ‡‰ç”¨å®¹å™¨ -->
    <div id="app-container" class="p-4 sm:p-8">
        <!-- JavaScript å°‡åœ¨æ­¤è™•æ¸²æŸ“å…§å®¹ -->
    </div>

    <script>
    // --- æ¨¡æ“¬æ•¸æ“š (Mock Data) ---
    const mockMembers = [
        { id: 'player_vip01', username: 'player_vip01', phone: '0912****56', status: 'enabled', is_under_risk_control: true, main_wallet_balance: 1250800.50, last_login_time: '2025-08-10T14:12:05Z', registration_time: '2025-08-01T10:30:15Z', has_deposited: true },
        { id: 'suspicious_01', username: 'suspicious_01', phone: '0988****12', status: 'enabled', is_under_risk_control: true, main_wallet_balance: 88.00, last_login_time: '2025-08-09T23:50:01Z', registration_time: '2025-08-03T11:20:45Z', has_deposited: true },
        { id: 'finance_issue_99', username: 'finance_issue_99', phone: '0933****77', status: 'disabled', is_under_risk_control: true, main_wallet_balance: 150.00, last_login_time: '2025-07-22T18:00:00Z', registration_time: '2025-07-22T17:30:15Z', has_deposited: true },
        { id: 'kyc_pending_user', username: 'kyc_pending_user', phone: '0966****34', status: 'enabled', is_under_risk_control: false, main_wallet_balance: 5320.00, last_login_time: '2025-08-10T09:15:22Z', registration_time: '2025-07-25T08:00:59Z', has_deposited: true },
        { id: 'new_user_05', username: 'new_user_05', phone: '0911****88', status: 'enabled', is_under_risk_control: false, main_wallet_balance: 0.00, last_login_time: '2025-08-10T16:45:00Z', registration_time: '2025-08-10T16:45:00Z', has_deposited: false },
        { id: 'test_user_06', username: 'test_user_06', phone: '0922****22', status: 'enabled', is_under_risk_control: false, main_wallet_balance: 100.00, last_login_time: '2025-08-11T10:00:00Z', registration_time: '2025-08-11T09:00:00Z', has_deposited: true },
        { id: 'test_user_07', username: 'test_user_07', phone: '0933****33', status: 'disabled', is_under_risk_control: false, main_wallet_balance: 200.00, last_login_time: '2025-08-11T11:00:00Z', registration_time: '2025-08-11T10:00:00Z', has_deposited: false },
    ];
    const mockMemberProfile = {
        id: 'player_vip01', status: 'enabled', is_under_risk_control: true,
        overview: { financial_summary: { total_deposit: 1500000, total_withdrawal: 250000, total_bet: 8880500, total_win_loss: -250000 }, key_info: { creation_time: '2025-08-01T10:30:15Z', first_deposit_time: '2025-08-01T11:05:20Z', last_login_time: '2025-08-10T14:12:05Z', last_login_ip: '101.12.50.180', is_last_login_ip_flagged: true, registration_ip: '118.163.25.10', is_registration_ip_flagged: false, registration_device_id: 'A857-D9F8-G6H5-J4K3' }, tags: ['VIP', 'è€è™æ©Ÿæ„›å¥½è€…', 'é«˜é¡ç©å®¶'] },
        account_info: { username: 'player_vip01', phone: '0912345678', real_name: 'é™³*æ–‡', email: 'player***@gmail.com', birth_date: '1990-05-20', gender: 'ç”·' },
        kyc_info: { status: 'approved', verified_data: { real_name: 'é™³å¤§æ–‡', id_number: 'A12****5678', birth_date: '1990-05-20', address: 'å°åŒ—å¸‚ä¿¡ç¾©å€***è·¯**è™Ÿ' }, records: [{ id: 'kyc001', submission_time: '2025-08-02T10:00:00Z', image_url: 'https://placehold.co/300x200/E2E8F0/4A5568?text=è­‰ä»¶æ­£é¢', reviewer: 'admin01', result: 'å·²é€šé', reason: '' }] },
        finances: { wallets: [ { type: 'main', name: 'ä¸»å¸³æˆ¶', balance: 1250800.50, unsettled_bet: 15000.00, total_balance: 1265800.50, withdrawable_balance: 1200000.00, withdrawal_limit: 5000000.00 }, { type: 'game_bonus', name: 'é«”è‚²éŒ¢åŒ…', balance: 88000.00, withdrawable_balance: 0, promotion_name: 'é«”è‚²é¦–å­˜é€100%', promotion_bonus: 500.00, wagering_requirement: 20000.00, wagering_progress_percent: 75.5 }, { type: 'game_bonus', name: 'çœŸäººéŒ¢åŒ…', balance: 12500.00, withdrawable_balance: 0, promotion_name: 'çœŸäººé—–é—œæ´»å‹•', promotion_bonus: 888.00, wagering_requirement: 15000.00, wagering_progress_percent: 45.0 }, { type: 'game_bonus', name: 'æ£‹ç‰ŒéŒ¢åŒ…', balance: 5300.00, withdrawable_balance: 5300.00, promotion_name: 'æ£‹ç‰ŒVIPè¿”åˆ©', promotion_bonus: 300.00, wagering_requirement: 5300.00, wagering_progress_percent: 100 }, { type: 'game_bonus', name: 'è€è™æ©ŸéŒ¢åŒ…', balance: 150000.00, withdrawable_balance: 0, promotion_name: 'è€è™æ©Ÿæ•‘æ´é‡‘', promotion_bonus: 2000.00, wagering_requirement: 40000.00, wagering_progress_percent: 10.0 } ], transaction_history: [ { id: 'D001', time: '2025-08-10T13:00:00Z', type: 'å­˜æ¬¾', amount: 50000, before_balance: 1200800.50, after_balance: 1250800.50, status: 'æˆåŠŸ', note: 'éŠ€è¡Œå¡è½‰å¸³' }, { id: 'W001', time: '2025-08-09T18:30:00Z', type: 'ææ¬¾', amount: -20000, before_balance: 1220800.50, after_balance: 1200800.50, status: 'æˆåŠŸ', note: '' }, { id: 'B001', time: '2025-08-08T10:00:00Z', type: 'ç´…åˆ©æ´¾ç™¼', amount: 500, before_balance: 1220300.50, after_balance: 1220800.50, status: 'æˆåŠŸ', note: 'VIPå‡ç´šç¦®é‡‘' }, { id: 'ADJ01', time: '2025-08-07T15:00:00Z', type: 'äººå·¥å­˜å…¥', amount: 1000, before_balance: 1219300.50, after_balance: 1220300.50, status: 'æˆåŠŸ', note: 'å®¢æœè£œå–®(æ‰å–®è™•ç†)' } ] },
        logs: { logins: [{ time: '2025-08-10T14:12:05Z', ip: '101.12.50.180', location: 'å°ç£', device: 'Chrome on Windows', result: 'æˆåŠŸ', reason: '' }], account_changes: [{ time: '2025-08-05T10:00:00Z', operator: 'player_vip01', item: 'ä¿®æ”¹å¯†ç¢¼', before: '********', after: '********' }, { time: '2025-08-02T11:00:00Z', operator: 'admin01', item: 'èª¿æ•´ç‹€æ…‹', before: 'å•Ÿç”¨', after: 'åœç”¨(é¢¨æ§æ¸¬è©¦)' }] },
        staff_notes: [{ time: '2025-08-09T11:00:00Z', operator: 'å®¢æœ A', note: 'æœƒå“¡ä¾†é›»è©¢å•VIPæ´»å‹•è©³æƒ…ï¼Œå·²å‘ŠçŸ¥ã€‚' }],
        active_risk_rules: [{ action: 'ç¦æ­¢å‡ºæ¬¾', reason: 'æµæ°´ä¸è¶³ï¼Œå°šæœ‰ 5000 æµæ°´æœªé”æˆã€‚', expires_at: '2025-08-15T23:59:59Z' }],
    };

    // --- ç‹€æ…‹ç®¡ç† (State Management) ---
    let state = {
        currentPage: 'list', // 'list' or 'dashboard'
        selectedMemberId: null,
        modal: null, // null, 'status', 'logout', or 'status-confirm'
        listFilters: { searchTerm: '', status: 'all', has_deposited: 'all' },
        listPagination: { currentPage: 1, itemsPerPage: 5 },
        visibleColumns: {
            username: true, phone: true, status: true, is_under_risk_control: true,
            main_wallet_balance: true, last_login_time: true, registration_time: true
        },
        dashboardTab: 'summary',
        logTab: 'login'
    };

    // --- è¼”åŠ©å‡½å¼ (Helpers) ---
    const formatDate = (dateString) => new Date(dateString).toLocaleString('zh-TW', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }).replace(/\//g, '-');
    const formatCurrency = (amount) => `â‚± ${new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(amount)}`;
    const getIcon = (name, size = 16) => {
        const icons = {
            search: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>`,
            user: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>`,
            phone: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>`,
            lock: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>`,
            wallet: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"></path><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"></path><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"></path></svg>`,
            clock: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>`,
            calendar: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>`,
            alert: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>`,
            chevronLeft: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>`,
            chevronRight: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>`,
            chevronsLeft: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="11 17 6 12 11 7"></polyline><polyline points="18 17 13 12 18 7"></polyline></svg>`,
            chevronsRight: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="13 17 18 12 13 7"></polyline><polyline points="6 17 11 12 6 7"></polyline></svg>`,
            fileDown: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>`,
            sliders: `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="21" x2="4" y2="14"></line><line x1="4" y1="10" x2="4" y2="3"></line><line x1="12" y1="21" x2="12" y2="12"></line><line x1="12" y1="8" x2="12" y2="3"></line><line x1="20" y1="21" x2="20" y2="16"></line><line x1="20" y1="12" x2="20" y2="3"></line><line x1="1" y1="14" x2="7" y2="14"></line><line x1="9" y1="8" x2="15" y2="8"></line><line x1="17" y1="16" x2="23" y2="16"></line></svg>`,
        };
        return icons[name] || '';
    };

    // --- æ¸²æŸ“å‡½å¼ (Render Functions) ---

    function renderApp() {
        const appContainer = document.getElementById('app-container');
        appContainer.innerHTML = ''; 

        if (state.currentPage === 'list') {
            appContainer.innerHTML = renderMemberListPage();
        } else if (state.currentPage === 'dashboard') {
            appContainer.innerHTML = renderMemberDashboardPage();
        }

        const existingModal = document.getElementById('modal-container');
        if(existingModal) existingModal.remove();

        if (state.modal) {
            document.body.insertAdjacentHTML('beforeend', renderModal());
        }
    }

    function renderMemberListPage() {
        const { listFilters, listPagination, visibleColumns } = state;
        const filteredMembers = mockMembers.filter(m => {
            const searchTermMatch = m.username.toLowerCase().includes(listFilters.searchTerm.toLowerCase()) || m.phone.includes(listFilters.searchTerm);
            const statusMatch = listFilters.status === 'all' || m.status === listFilters.status;
            const depositMatch = listFilters.has_deposited === 'all' || String(m.has_deposited) === listFilters.has_deposited;
            return searchTermMatch && statusMatch && depositMatch;
        });

        const totalPages = Math.ceil(filteredMembers.length / listPagination.itemsPerPage);
        const startIndex = (listPagination.currentPage - 1) * listPagination.itemsPerPage;
        const paginatedMembers = filteredMembers.slice(startIndex, startIndex + listPagination.itemsPerPage);

        const columns = [
            { id: 'username', label: 'æœƒå“¡å¸³è™Ÿ' },
            { id: 'phone', label: 'æ‰‹æ©Ÿè™Ÿç¢¼' },
            { id: 'status', label: 'ç‹€æ…‹' },
            { id: 'is_under_risk_control', label: 'é¢¨æ§ç‹€æ…‹' },
            { id: 'main_wallet_balance', label: 'ä¸»éŒ¢åŒ…é¤˜é¡', isRight: true },
            { id: 'last_login_time', label: 'æœ€å¾Œç™»å…¥æ™‚é–“' },
            { id: 'registration_time', label: 'è¨»å†Šæ™‚é–“' }
        ];
        const activeColumns = columns.filter(c => visibleColumns[c.id]);

        return `
            <div class="space-y-6">
                <h1 class="text-3xl font-bold text-gray-900">ğŸ‘¥ æœƒå“¡æŸ¥è©¢</h1>
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                        <div class="lg:col-span-2">
                            <label class="text-sm font-medium text-gray-700">æœå°‹</label>
                            <div class="relative mt-1">
                                <div class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400">${getIcon('search', 20)}</div>
                                <input type="text" placeholder="è«‹è¼¸å…¥æœƒå“¡å¸³è™Ÿæˆ–æ‰‹æ©Ÿè™Ÿç¢¼" class="w-full pl-10 p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" value="${listFilters.searchTerm}" data-filter="searchTerm">
                            </div>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-700">å¸³è™Ÿç‹€æ…‹</label>
                            <select class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" data-filter="status">
                                <option value="all" ${listFilters.status === 'all' ? 'selected' : ''}>å…¨éƒ¨</option>
                                <option value="enabled" ${listFilters.status === 'enabled' ? 'selected' : ''}>å•Ÿç”¨</option>
                                <option value="disabled" ${listFilters.status === 'disabled' ? 'selected' : ''}>åœç”¨</option>
                            </select>
                        </div>
                        <div>
                            <label class="text-sm font-medium text-gray-700">æ˜¯å¦å­˜æ¬¾</label>
                            <select class="w-full mt-1 p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" data-filter="has_deposited">
                                <option value="all" ${listFilters.has_deposited === 'all' ? 'selected' : ''}>å…¨éƒ¨</option>
                                <option value="true" ${listFilters.has_deposited === 'true' ? 'selected' : ''}>æ˜¯</option>
                                <option value="false" ${listFilters.has_deposited === 'false' ? 'selected' : ''}>å¦</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button class="px-4 py-2 rounded-lg font-semibold bg-gray-200 text-gray-800 hover:bg-gray-300" data-action="reset-filters">é‡è¨­</button>
                        <button class="px-4 py-2 rounded-lg font-semibold bg-blue-600 text-white hover:bg-blue-700 flex items-center gap-2" data-action="apply-filters">${getIcon('search', 16)} æœå°‹</button>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex justify-end items-center mb-4 gap-2">
                        <button class="px-4 py-2 rounded-lg font-semibold bg-gray-200 text-gray-800 hover:bg-gray-300 flex items-center gap-2">${getIcon('fileDown', 16)} åŒ¯å‡º</button>
                        <div class="dropdown">
                            <button class="p-2 rounded-md hover:bg-gray-100">${getIcon('sliders', 16)}</button>
                            <div class="dropdown-content">
                                ${columns.map(col => `
                                    <label>
                                        <input type="checkbox" data-action="toggle-column" data-column="${col.id}" ${visibleColumns[col.id] ? 'checked' : ''} class="mr-2">
                                        ${col.label}
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-gray-50 text-gray-600 uppercase text-xs">
                                <tr>
                                    ${activeColumns.map(col => `<th class="p-4 ${col.isRight ? 'text-right' : ''}">${col.label}</th>`).join('')}
                                    <th class="p-4 text-center">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y">
                                ${paginatedMembers.map(member => `
                                    <tr class="hover:bg-gray-50">
                                        ${activeColumns.map(col => {
                                            let content = '';
                                            switch(col.id) {
                                                case 'username': content = `<div class="flex items-center gap-2">${getIcon('user', 16)} ${member.username}</div>`; break;
                                                case 'phone': content = `<div class="flex items-center gap-2">${getIcon('phone', 16)} ${member.phone}</div>`; break;
                                                case 'status': content = renderStatusBadge(member.status); break;
                                                case 'is_under_risk_control': content = member.is_under_risk_control ? `<div class="tooltip inline-block">${getIcon('lock', 16)}<span class="tooltiptext">è©²æœƒå“¡å—é¢¨æ§è¦å‰‡å½±éŸ¿</span></div>` : ''; break;
                                                case 'main_wallet_balance': content = `<div class="flex items-center justify-end gap-2">${getIcon('wallet', 16)} ${formatCurrency(member.main_wallet_balance)}</div>`; break;
                                                case 'last_login_time': content = `<div class="flex items-center gap-2">${getIcon('clock', 16)} ${formatDate(member.last_login_time)}</div>`; break;
                                                case 'registration_time': content = `<div class="flex items-center gap-2">${getIcon('calendar', 16)} ${formatDate(member.registration_time)}</div>`; break;
                                            }
                                            return `<td class="p-4 ${col.isRight ? 'text-right font-mono' : ''}">${content}</td>`
                                        }).join('')}
                                        <td class="p-4 text-center"><button class="text-blue-600 hover:underline font-semibold" data-action="view-dashboard" data-id="${member.id}">æŸ¥çœ‹è©³æƒ…</button></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                    ${paginatedMembers.length === 0 ? '<div class="text-center py-12 text-gray-500">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„æœƒå“¡ï¼Œè«‹å˜—è©¦æ›´æ›ç¯©é¸æ¢ä»¶ã€‚</div>' : ''}
                    ${renderPagination(listPagination.currentPage, totalPages)}
                </div>
            </div>
        `;
    }
    
    function renderMemberDashboardPage() {
        const member = mockMembers.find(m => m.id === state.selectedMemberId);
        const profile = mockMemberProfile;
        const tabs = [
            { id: 'summary', label: 'ç¸½è¦½' }, { id: 'account', label: 'å¸³æˆ¶è³‡è¨Š' }, { id: 'kyc', label: 'KYC è³‡æ–™' }, { id: 'finances', label: 'éŒ¢åŒ…èˆ‡å¸³å‹™' }, { id: 'logs', label: 'æ“ä½œæ—¥èªŒ' }, { id: 'notes', label: 'äººå“¡å‚™è¨»' },
        ];

        return `
            <div class="space-y-6">
                <div class="flex justify-between items-start">
                    <div>
                        <button class="flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-2" data-action="back-to-list">
                            ${getIcon('chevronLeft', 20)} è¿”å›æœƒå“¡æŸ¥è©¢
                        </button>
                        <div class="flex items-center gap-4">
                            <h1 class="text-3xl font-bold text-gray-900">${member.username}</h1>
                            ${renderStatusBadge(profile.status)}
                            ${profile.is_under_risk_control ? `
                                <div class="tooltip">
                                    <div class="flex items-center gap-1 bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-sm cursor-pointer">
                                        ${getIcon('lock', 14)} é¢¨éšªç®¡åˆ¶ä¸­
                                    </div>
                                    <div class="tooltiptext">
                                        <p class="font-bold border-b pb-1 mb-1">ç”Ÿæ•ˆä¸­çš„é¢¨æ§è¦å‰‡</p>
                                        ${profile.active_risk_rules.map(rule => `<p>â€¢ ${rule.action}: ${rule.reason}</p>`).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button class="px-4 py-2 rounded-lg font-semibold bg-gray-200 text-gray-800 hover:bg-gray-300" data-action="open-modal" data-modal="status">èª¿æ•´ç‹€æ…‹</button>
                        <button class="px-4 py-2 rounded-lg font-semibold bg-red-600 text-white hover:bg-red-700" data-action="open-modal" data-modal="logout">å¼·åˆ¶ä¸‹ç·š</button>
                    </div>
                </div>
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-6 overflow-x-auto">
                        ${tabs.map(tab => `
                            <button data-action="switch-tab" data-tab="${tab.id}" class="shrink-0 ${state.dashboardTab === tab.id ? 'border-blue-600 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                ${tab.label}
                            </button>
                        `).join('')}
                    </nav>
                </div>
                <div>${renderTabContent()}</div>
            </div>
        `;
    }

    function renderTabContent() {
        const profile = mockMemberProfile;
        switch (state.dashboardTab) {
            case 'summary': return `<div class="space-y-8"> <div class="bg-white rounded-xl shadow-sm p-6"><h3 class="text-lg font-semibold mb-4">æ•¸æ“šç¸½è¦½</h3><div class="grid grid-cols-2 md:grid-cols-4 gap-6 text-center"><div><p class="text-sm text-gray-500">ç¸½å­˜æ¬¾</p><p class="text-2xl font-bold">${formatCurrency(profile.overview.financial_summary.total_deposit)}</p></div><div><p class="text-sm text-gray-500">ç¸½ææ¬¾</p><p class="text-2xl font-bold">${formatCurrency(profile.overview.financial_summary.total_withdrawal)}</p></div><div><p class="text-sm text-gray-500">ç¸½æŠ•æ³¨</p><p class="text-2xl font-bold">${formatCurrency(profile.overview.financial_summary.total_bet)}</p></div><div><p class="text-sm text-gray-500">ç¸½è¼¸è´</p><p class="text-2xl font-bold ${profile.overview.financial_summary.total_win_loss < 0 ? 'text-red-600' : 'text-green-600'}">${formatCurrency(profile.overview.financial_summary.total_win_loss)}</p></div></div></div> <div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="bg-white rounded-xl shadow-sm p-6"><h3 class="text-lg font-semibold mb-4">é—œéµæ™‚é–“é»</h3><div class="space-y-3 text-sm"><div class="flex justify-between"><span>å‰µå¸³æ™‚é–“</span><span class="font-mono">${formatDate(profile.overview.key_info.creation_time)}</span></div><div class="flex justify-between"><span>é¦–æ¬¡å……å€¼æ™‚é–“</span><span class="font-mono">${formatDate(profile.overview.key_info.first_deposit_time)}</span></div><div class="flex justify-between"><span>æœ€å¾Œç™»å…¥æ™‚é–“</span><span class="font-mono">${formatDate(profile.overview.key_info.last_login_time)}</span></div></div></div><div class="bg-white rounded-xl shadow-sm p-6"><h3 class="text-lg font-semibold mb-4">é—œéµä¾†æºè³‡è¨Š</h3><div class="space-y-3 text-sm"><div class="flex justify-between items-center"><span>ä¸Šæ¬¡ç™»å…¥IP</span><span class="font-mono flex items-center gap-2">${profile.overview.key_info.last_login_ip} ${profile.overview.key_info.is_last_login_ip_flagged ? `<div class="tooltip">${getIcon('alert', 16)}<span class="tooltiptext">æ­¤IPå·²è¢«é¢¨æ§æ¨™è¨˜</span></div>` : ''}</span></div><div class="flex justify-between"><span>è¨»å†ŠIP</span><span class="font-mono">${profile.overview.key_info.registration_ip}</span></div><div class="flex justify-between"><span>è¨»å†Šè£ç½®ç¢¼</span><span class="font-mono">${profile.overview.key_info.registration_device_id}</span></div></div></div></div> <div class="bg-white rounded-xl shadow-sm p-6"><h3 class="text-lg font-semibold mb-4">ç©å®¶æ¨™ç±¤</h3><div class="flex flex-wrap gap-2">${profile.overview.tags.map(tag => `<span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">${tag}</span>`).join('')}</div></div> </div>`;
            case 'account': return `<div class="bg-white rounded-xl shadow-sm p-6"><h3 class="text-lg font-semibold mb-6">åŸºæœ¬è³‡æ–™</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 text-sm">${Object.entries({ 'æœƒå“¡å¸³è™Ÿ': profile.account_info.username, 'æ‰‹æ©Ÿè™Ÿç¢¼': profile.account_info.phone, 'çœŸå¯¦å§“å': profile.account_info.real_name, 'é›»å­éƒµä»¶': profile.account_info.email, 'ç”Ÿæ—¥': profile.account_info.birth_date, 'æ€§åˆ¥': profile.account_info.gender }).map(([key, value]) => `<div class="flex justify-between border-b pb-2"><span class="text-gray-500">${key}</span><span>${value}</span></div>`).join('')}</div></div>`;
            case 'kyc': return `<div class="space-y-8"> <div class="bg-white rounded-xl shadow-sm p-6"> <div class="flex items-center gap-4 mb-6"> <h3 class="text-lg font-semibold">KYC ç‹€æ…‹</h3> ${renderStatusBadge(profile.kyc_info.status)} </div> <h4 class="text-md font-semibold mb-4">å·²é©—è­‰è³‡æ–™</h4> <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 text-sm bg-gray-50 p-4 rounded-lg"> <div class="flex justify-between"><span class="text-gray-500">èªè­‰å§“å</span><span>${profile.kyc_info.verified_data.real_name}</span></div> <div class="flex justify-between"><span class="text-gray-500">è­‰ä»¶è™Ÿç¢¼</span><span>${profile.kyc_info.verified_data.id_number}</span></div> <div class="flex justify-between"><span class="text-gray-500">èªè­‰ç”Ÿæ—¥</span><span>${profile.kyc_info.verified_data.birth_date}</span></div> <div class="flex justify-between md:col-span-2"><span class="text-gray-500">èªè­‰åœ°å€</span><span>${profile.kyc_info.verified_data.address}</span></div> </div> </div> <div class="bg-white rounded-xl shadow-sm p-6"> <h4 class="text-md font-semibold mb-4">æäº¤ç´€éŒ„</h4> <div class="overflow-x-auto"><table class="w-full text-sm"><thead class="bg-gray-50 text-left"><tr><th class="p-3">æäº¤æ™‚é–“</th><th class="p-3">è­‰ä»¶åœ–ç‰‡</th><th class="p-3">å¯©æ ¸äººå“¡</th><th class="p-3">å¯©æ ¸çµæœ</th></tr></thead><tbody>${profile.kyc_info.records.map(record => `<tr><td class="p-3">${formatDate(record.submission_time)}</td><td class="p-3"><img src="${record.image_url}" alt="è­‰ä»¶" class="w-24 h-auto rounded-md cursor-pointer hover:opacity-80"/></td><td class="p-3">${record.reviewer}</td><td class="p-3">${renderStatusBadge(record.result === 'å·²é€šé' ? 'approved' : 'rejected')}</td></tr>`).join('')}</tbody></table></div> </div> </div>`;
            case 'finances': return `<div class="space-y-8"> <div class="bg-white rounded-xl shadow-sm p-6"> <h3 class="text-lg font-semibold mb-4">éŒ¢åŒ…ç¸½è¦½</h3> <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"> ${profile.finances.wallets.map(wallet => `<div class="bg-gray-50 p-4 rounded-lg border"> <h4 class="font-bold mb-2 text-gray-800">${wallet.name}</h4> ${wallet.type === 'main' ? `<div class="space-y-2 text-sm"> <div class="flex justify-between"><span>ç¾é‡‘é¤˜é¡</span><span class="font-mono">${formatCurrency(wallet.balance)}</span></div> <div class="flex justify-between"><span>ä¸‹æ³¨æœªçµé¡</span><span class="font-mono">${formatCurrency(wallet.unsettled_bet)}</span></div> <div class="flex justify-between font-semibold border-t pt-2 mt-2"><span>åˆè¨ˆé¤˜é¡</span><span class="font-mono">${formatCurrency(wallet.total_balance)}</span></div> <div class="flex justify-between text-green-600 font-semibold"><span>å¯æé‡‘é¡</span><span class="font-mono">${formatCurrency(wallet.withdrawable_balance)}</span></div> </div>` : `<div class="space-y-2 text-sm"> <p class="font-semibold text-blue-600 truncate" title="${wallet.promotion_name}">${wallet.promotion_name}</p> <div class="flex justify-between"><span>éŒ¢åŒ…é¤˜é¡</span><span class="font-mono">${formatCurrency(wallet.balance)}</span></div> <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2"><div class="bg-blue-600 h-2.5 rounded-full" style="width: ${wallet.wagering_progress_percent}%"></div></div> <div class="flex justify-between text-xs text-gray-500"> <span>æµæ°´é”æˆç‡: ${wallet.wagering_progress_percent}%</span> <span>ç›®æ¨™: ${formatCurrency(wallet.wagering_requirement)}</span> </div> </div>`} </div>`).join('')} </div> </div> <div class="bg-white rounded-xl shadow-sm p-6">
                <!-- HYBRID MODE IMPLEMENTATION -->
                <div class="flex flex-wrap items-center gap-4 mb-4">
                    <h3 class="text-lg font-semibold">è¿‘æœŸäº¤æ˜“ç´€éŒ„</h3>
                    <div class="flex-grow"></div>
                    <button class="px-4 py-2 rounded-lg font-semibold bg-gray-200 text-gray-800 hover:bg-gray-300 text-sm">æŸ¥çœ‹å…¨éƒ¨äº¤æ˜“ç´€éŒ„</button>
                </div>
                <div class="overflow-x-auto"> <table class="w-full text-sm"> <thead class="bg-gray-50 text-left"><tr><th class="p-3">äº¤æ˜“å–®è™Ÿ</th><th class="p-3">äº¤æ˜“æ™‚é–“</th><th class="p-3">é¡å‹</th><th class="p-3 text-right">é‡‘é¡</th><th class="p-3 text-right">äº¤æ˜“å¾Œé¤˜é¡</th><th class="p-3">ç‹€æ…‹</th><th class="p-3">å‚™è¨»</th></tr></thead> <tbody> ${profile.finances.transaction_history.slice(0, 3).map(tx => `<tr> <td class="p-3 font-mono text-gray-500">${tx.id}</td> <td class="p-3">${formatDate(tx.time)}</td> <td class="p-3 font-medium">${tx.type}</td> <td class="p-3 text-right font-mono ${tx.amount > 0 ? 'text-green-600' : 'text-red-600'}">${tx.amount > 0 ? '+' : ''}${formatCurrency(tx.amount)}</td> <td class="p-3 text-right font-mono text-gray-600">${formatCurrency(tx.after_balance)}</td> <td class="p-3">${renderStatusBadge(tx.status === 'æˆåŠŸ' ? 'approved' : 'rejected')}</td> <td class="p-3 text-gray-500">${tx.note}</td> </tr>`).join('')} </tbody> </table> </div> </div> </div>`;
            case 'logs': return `<div class="bg-white rounded-xl shadow-sm p-6"><div class="flex border-b mb-4"><button data-action="switch-log-tab" data-log-tab="login" class="py-2 px-4 ${state.logTab === 'login' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-500'}">ç™»å…¥ç´€éŒ„</button><button data-action="switch-log-tab" data-log-tab="account" class="py-2 px-4 ${state.logTab === 'account' ? 'border-b-2 border-blue-600 text-blue-600' : 'text-gray-500'}">å¸³æˆ¶è®Šå‹•ç´€éŒ„</button></div>${renderLogContent(profile)}</div>`;
            case 'notes': return `<div class="grid grid-cols-1 lg:grid-cols-3 gap-8"><div class="lg:col-span-2"><div class="bg-white rounded-xl shadow-sm p-6"><h3 class="text-lg font-semibold mb-4">æ­·å²å‚™è¨»</h3><div class="space-y-4">${profile.staff_notes.map(note => `<div class="bg-gray-50 p-4 rounded-lg"><p class="text-sm text-gray-800 mb-2">${note.note}</p><div class="text-xs text-gray-500 flex justify-end"><span>${note.operator} æ–¼ ${formatDate(note.time)}</span></div></div>`).join('')}</div></div></div><div><div class="bg-white rounded-xl shadow-sm p-6"><h3 class="text-lg font-semibold mb-4">æ–°å¢å‚™è¨»</h3><textarea class="w-full p-2 border border-gray-300 rounded-lg h-32" placeholder="è«‹è¼¸å…¥å‚™è¨»å…§å®¹..."></textarea><button class="w-full mt-4 px-4 py-2 rounded-lg font-semibold bg-blue-600 text-white hover:bg-blue-700">å„²å­˜</button></div></div></div>`;
            default: return '';
        }
    }

    function renderLogContent(profile) {
        if (state.logTab === 'login') {
            return `<div class="overflow-x-auto"><table class="w-full text-sm"><thead class="bg-gray-50 text-left"><tr><th class="p-3">æ™‚é–“</th><th class="p-3">IPä½å€</th><th class="p-3">åœ°ç†ä½ç½®</th><th class="p-3">ç™»å…¥è£ç½®</th><th class="p-3">çµæœ</th></tr></thead><tbody>${profile.logs.logins.map(log => `<tr><td class="p-3">${formatDate(log.time)}</td><td class="p-3">${log.ip}</td><td class="p-3">${log.location}</td><td class="p-3">${log.device}</td><td class="p-3">${renderStatusBadge(log.result === 'æˆåŠŸ' ? 'approved' : 'rejected')}</td></tr>`).join('')}</tbody></table></div>`;
        } else {
            return `<div class="overflow-x-auto"><table class="w-full text-sm"><thead class="bg-gray-50 text-left"><tr><th class="p-3">æ™‚é–“</th><th class="p-3">æ“ä½œäºº</th><th class="p-3">è®Šæ›´é …ç›®</th><th class="p-3">è®Šæ›´å‰</th><th class="p-3">è®Šæ›´å¾Œ</th></tr></thead><tbody>${profile.logs.account_changes.map(log => `<tr><td class="p-3">${formatDate(log.time)}</td><td class="p-3">${log.operator}</td><td class="p-3">${log.item}</td><td class="p-3">${log.before}</td><td class="p-3">${log.after}</td></tr>`).join('')}</tbody></table></div>`;
        }
    }

    function renderModal() {
        const member = mockMembers.find(m => m.id === state.selectedMemberId);
        let content = '';
        if (state.modal === 'status') {
            content = `
                <h2 class="text-2xl font-bold text-gray-800 mb-4">èª¿æ•´å¸³è™Ÿç‹€æ…‹</h2>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ç‚º ${member.username} é¸æ“‡æ–°ç‹€æ…‹</label>
                    <select id="status-select" class="w-full p-2 border border-gray-300 rounded-lg">
                        <option value="enabled" ${member.status === 'enabled' ? 'selected' : ''}>å•Ÿç”¨</option>
                        <option value="disabled" ${member.status === 'disabled' ? 'selected' : ''}>åœç”¨</option>
                    </select>
                </div>
                <p class="text-gray-600 mb-8">è«‹ç¢ºèªæ‚¨çš„æ“ä½œã€‚</p>
                <div class="flex justify-end gap-4">
                    <button class="px-4 py-2 rounded-lg font-semibold bg-gray-200 text-gray-800 hover:bg-gray-300" data-action="close-modal">å–æ¶ˆ</button>
                    <button class="px-4 py-2 rounded-lg font-semibold bg-blue-600 text-white hover:bg-blue-700" data-action="confirm-status">ç¢ºèª</button>
                </div>
            `;
        } else if (state.modal === 'status-confirm') {
            content = `
                <h2 class="text-2xl font-bold text-red-600 mb-4 flex items-center gap-2">${getIcon('alert')} äºŒæ¬¡ç¢ºèª</h2>
                <p class="text-gray-600 mb-8">æ‚¨ç¢ºå®šè¦ **åœç”¨** æœƒå“¡ ${member.username} çš„å¸³è™Ÿå—ï¼Ÿ<br/>æ­¤æ“ä½œå°‡å°è‡´æœƒå“¡ç„¡æ³•ç™»å…¥ã€‚</p>
                <div class="flex justify-end gap-4">
                    <button class="px-4 py-2 rounded-lg font-semibold bg-gray-200 text-gray-800 hover:bg-gray-300" data-action="close-modal">å–æ¶ˆ</button>
                    <button class="px-4 py-2 rounded-lg font-semibold bg-red-600 text-white hover:bg-red-700" data-action="confirm-action">ç¢ºèªåœç”¨</button>
                </div>
            `;
        } else if (state.modal === 'logout') {
            content = `
                <h2 class="text-2xl font-bold text-red-600 mb-4 flex items-center gap-2">${getIcon('alert')} ç¢ºèªå¼·åˆ¶ä¸‹ç·š</h2>
                <p class="text-gray-600 mb-8">æ‚¨ç¢ºå®šè¦å¼·åˆ¶ä¸‹ç·š ${member.username} å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚</p>
                <div class="flex justify-end gap-4">
                    <button class="px-4 py-2 rounded-lg font-semibold bg-gray-200 text-gray-800 hover:bg-gray-300" data-action="close-modal">å–æ¶ˆ</button>
                    <button class="px-4 py-2 rounded-lg font-semibold bg-red-600 text-white hover:bg-red-700" data-action="confirm-action">ç¢ºèªä¸‹ç·š</button>
                </div>
            `;
        }
        return `<div id="modal-container" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"><div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md">${content}</div></div>`;
    }

    function renderStatusBadge(status) {
        const variants = { enabled: 'bg-green-100 text-green-800', disabled: 'bg-gray-100 text-gray-800', approved: 'bg-green-100 text-green-800', pending: 'bg-yellow-100 text-yellow-800', rejected: 'bg-red-100 text-red-800' };
        const text = { enabled: 'å•Ÿç”¨', disabled: 'åœç”¨', approved: 'å·²é€šé', pending: 'å¯©æ ¸ä¸­', rejected: 'å·²æ‹’çµ•' };
        return `<span class="px-2 py-1 text-xs font-medium rounded-full ${variants[status] || ''}">${text[status] || status}</span>`;
    }

    function renderPagination(currentPage, totalPages) {
        if (totalPages <= 1) return '';
        return `
            <div class="flex justify-center items-center mt-6 text-sm">
                <button data-action="go-to-page" data-page="1" ${currentPage === 1 ? 'disabled' : ''} class="p-2 rounded-md hover:bg-gray-100 disabled:opacity-50">${getIcon('chevronsLeft', 16)}</button>
                <button data-action="go-to-page" data-page="${currentPage - 1}" ${currentPage === 1 ? 'disabled' : ''} class="p-2 rounded-md hover:bg-gray-100 disabled:opacity-50">${getIcon('chevronLeft', 16)}</button>
                <div class="mx-2">ç¬¬ ${currentPage} é  / å…± ${totalPages} é </div>
                <button data-action="go-to-page" data-page="${currentPage + 1}" ${currentPage === totalPages ? 'disabled' : ''} class="p-2 rounded-md hover:bg-gray-100 disabled:opacity-50">${getIcon('chevronRight', 16)}</button>
                <button data-action="go-to-page" data-page="${totalPages}" ${currentPage === totalPages ? 'disabled' : ''} class="p-2 rounded-md hover:bg-gray-100 disabled:opacity-50">${getIcon('chevronsRight', 16)}</button>
            </div>
        `;
    }

    // --- äº‹ä»¶è™•ç† (Event Handlers) ---
    document.addEventListener('click', e => {
        const target = e.target.closest('[data-action]');
        if (!target) return;

        const { action, id, page, tab, modal, logTab } = target.dataset;

        switch (action) {
            case 'view-dashboard': state.currentPage = 'dashboard'; state.selectedMemberId = id; break;
            case 'back-to-list': state.currentPage = 'list'; state.selectedMemberId = null; break;
            case 'apply-filters': state.listPagination.currentPage = 1; break;
            case 'reset-filters': state.listFilters = { searchTerm: '', status: 'all', has_deposited: 'all' }; state.listPagination.currentPage = 1; break;
            case 'go-to-page': state.listPagination.currentPage = parseInt(page); break;
            case 'switch-tab': state.dashboardTab = tab; break;
            case 'switch-log-tab': state.logTab = logTab; break;
            case 'open-modal': state.modal = modal; break;
            case 'confirm-status':
                const newStatus = document.getElementById('status-select').value;
                if (newStatus === 'disabled') {
                    state.modal = 'status-confirm';
                } else {
                    state.modal = null;
                }
                break;
            case 'close-modal':
            case 'confirm-action':
                state.modal = null;
                break;
        }
        renderApp();
    });

    document.addEventListener('input', e => {
        const filterTarget = e.target.closest('[data-filter]');
        if (filterTarget) {
            state.listFilters[filterTarget.dataset.filter] = filterTarget.value;
        }

        const columnTarget = e.target.closest('[data-action="toggle-column"]');
        if (columnTarget) {
            const columnId = columnTarget.dataset.column;
            state.visibleColumns[columnId] = columnTarget.checked;
            renderApp();
        }
    });

    // --- åˆå§‹åŒ– ---
    renderApp();

    </script>
</body>
</html>
